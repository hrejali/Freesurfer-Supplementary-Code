%Name:Hossein Rejali
%Superviser:Dr.Ali Khan
%Date:December 6th 2017
%Title: Intersubject OverlayLabelIntersection

%%
%..............................Description................................
%Summary:Extracts intensities from surface overlay corresponding to a
%particular label for each subject. Next do statistical analysis on region
%of interests

%%
Annot='aparc.a2009s';
Output=struct;
temp=OverlayLabelIntersection(Annot,'01');
Output.LabelName=temp.LabelName;
Output.Label=temp.Label;
Output.Subj(1).Overlay=temp.Overlay;
Output.Subj(1).OverlayThresh=temp.OverlayThresh;

%initializing variables
NumSubj=41;
NumLabel=length(Output.LabelName);
NumDepth=2;

for i=2:NumSubj
    if i <= 9
        subjNUM=['0',int2str(i)];
    else
        subjNUM=int2str(i);
        
    end
    try
        temp=OverlayLabelIntersection(Annot,subjNUM);
        Output.Subj(i).Overlay=temp.Overlay;
        Output.Subj(i).OverlayThresh=temp.OverlayThresh;
    catch
        %do nothing
        
    end
end
%%
%Storing Mean values at a particular label for each patient and depth

for i=1:NumSubj
    for j=1:NumLabel
        for k=1:NumDepth
            try
                Output.Subj(i).LabelMean(j).lh.Depth(k)=mean(Output.Subj(i).OverlayThresh(k).lh(Output.Label(j).lh));
                Output.Subj(i).LabelMean(j).rh.Depth(k)=mean(Output.Subj(i).OverlayThresh(k).rh(Output.Label(j).rh));
                
                
            catch
                
            end
        end
    end
end

%%
%Creating plots for the mean values
%k=1;
for i=1:NumDepth
    for j=1:NumLabel
        for k=1:NumSubj
            if(k==15)
                continue;
            end
            try
                RH_Mean(k)=Output.Subj(k).LabelMean(j).rh.Depth(i);
                LH_Mean(k)=Output.Subj(k).LabelMean(j).lh.Depth(i);
                
                Output.MeanAcrossSubj(j).rh.Depth(i)=mean(RH_Mean);
                Output.STDAcrossSubj(j).rh.Depth(i)=std(RH_Mean);
                
                Output.MeanAcrossSubj(j).lh.Depth(i)=mean(LH_Mean);
                Output.STDAcrossSubj(j).lh.Depth(i)=std(LH_Mean);
                
            end
            
        end
        try
            subplot(4,19,j); scatter(1:41,RH_Mean); %title(Output.LabelName(j));%xlabel('Subjects');ylabel('Mean R1 Intensity')
            hold on;
            subplot(4,19,j); scatter(1:41,LH_Mean,'r');
            
            hold on;
            subplot(4,19,j); plot(1:41,Output.MeanAcrossSubj(j).rh.Depth(i)*ones(41),'g--');
            hold on;
            subplot(4,19,j); plot(1:41,Output.STDAcrossSubj(j).rh.Depth(i)*ones(41),'r--');
            

            %hold on;
            %subplot(4,19,j); plot(1:41,Output.MeanAcrossSubj(j).rh.Depth(i)*ones(41),'y--');
        end

    end
         figure;

end

